<div *ngIf="isLoading" class="loading">
  <img src="../assets/images/cube-loading.svg" style="width: 4em">
</div>
<div *ngIf="device" class="device-wrapper">
  <div class="header">
    <div class="left-side">
      <!-- <img src="../assets/images/devices/beacon-icon.png" class="rogo-type-icon"> -->
      <div class="rogo-type-icon">
        <span *ngIf="currentTemp" class="rogo-type-text">{{ currentTemp | number : '2.1-1' }}°</span>
      </div>
      <div class="device-info">
        <div class="device-name">
          {{device.name}}
          <div class="rogo-type">
            <span [ngSwitch]="device.type">
              <span *ngSwitchCase="'Air'">AIR</span>
              <span *ngSwitchCase="'Sensor'">Sensor</span>
              <span *ngSwitchCase="'Alfa'">ALFA</span>
            </span>
          </div>
          <img *ngIf="isDeletingDevice" class="device-deleting-icon" src="../assets/images/device/loading-icon.svg">
        </div>
        <div class="device-id">
          <span class="id-header">ID: </span> {{device.id}}
        </div>
        <div class="device-status">
          <div *ngIf="device.status == true" style="color: #3eb54a">
            <img class="active-icon" src="../assets/images/devices/active-icon.png"> Active
          </div>
          <div *ngIf="device.status == false">
            <img class="disconnected-icon" src="../assets/images/devices/disconnected-icon.png"> Disconnected
          </div>
        </div>
        <div class="device-power-source" [ngSwitch]="device.type">
          <div *ngSwitchCase="'Sensor'">
            <img class="plugged-in-icon" src="../assets/images/device/plugged-in-icon.png"> Nguồn điện
          </div>
          <div *ngSwitchCase="'Air'">
            <img class="battery-icon" src="../assets/images/device/battery-icon.png"> 52%
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="device.type != 'Sensor'" class="tabs">
      <div class="first-tab active" (click)="switchToFirst()">
        {{ (device.type == 'Alfa' ? 'device-control-tab' : 'device-history-tab') | translate}}
      </div>
      <div class="settings-tab" (click)="switchToSettings()">
        {{'device-settings-tab' | translate}}
      </div>
      <img class="action-button-icon" src="../assets/images/device/action-button-icon.png" (click)="toggleEditPopup($event)">
      <div class="edit-popup">
        <div class="edit-button" (click)="closeEditPopup($event)">{{'devices-edit' | translate}}</div>
        <div class="edit-button" (click)="removeDevice()">{{'devices-remove' | translate}}</div>
      </div>
    </div>
  </div>
  <div class="content">
    <div class="first-content">
      <div *ngIf="device.type == 'Alfa' && device.simulate" class="control-content">
        <div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> AIR CONDITIONER TARGET
        </div>
        <div *ngIf="device" class="air-conditioners">
          <div *ngFor="let ac of device.ac" class="ac">{{ac}}</div>
        </div>
        <div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> OVERRIDE LOCATION SETTINGS
          <div class="bullet-content">
            <div class="bullet-subtitle">{{'device-override-subtitle' | translate}}</div>
            <ui-switch *ngIf="device" size="small" [(ngModel)]="device.forcecontrol" color="#448ccb" (change)="setForcecontrol($event)"></ui-switch>
          </div>
        </div>
        <div class="override-settings">
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-settings-explain-1' | translate}}
          <ul class="bullet-text">
            <li>{{'device-settings-explain-2' | translate}}</li>
            <li>{{'device-settings-explain-3' | translate}}</li>
            <li>{{'device-settings-explain-4' | translate}}</li>
            <li>{{'device-settings-explain-5' | translate}}</li>
          </ul>
          <div class="switch-wrapper">
            <img class="switch-bg-icon" src="../assets/images/device/switch-icon.png">
            <img class="switch-icon a" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon b" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon c" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon d" src="../assets/images/device/switch-active-icon.png">
            <span class="option-1">{{'device-no-operation' | translate}}</span>
            <span class="option-2">{{'device-set-point' | translate}}</span>
            <span class="option-3">{{'device-schedule' | translate}}</span>
            <span class="option-4">{{'device-power-off' | translate}}</span>
          </div>
          <div style="margin-top: 3em; border-top: 0.08em solid #d9dde7; padding-top: 1em">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-set-point' | translate}}
            <img *ngIf="isSetpointLoading" class="setpoint-loading-icon" src="../assets/images/device/loading-icon.svg">
          </div>
          <div class="no-select" style="margin-top: 2em;">
            <div class="minus-icon" (click)="decreaseTemp()">-</div>
            <div class="temp2">{{temp | number:'2.1-1'}}</div>
            <div class="degree">°</div>
            <div class="plus-icon" (click)="increaseTemp()">+</div>
          </div>
          <div [class.opaque]="device.mode != 'SCHEDULE'" style="margin-top: 3em; border-top: 0.08em solid #d9dde7; padding-top: 1em">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-schedule' | translate}}
          </div>
          <div [class.opaque]="device.mode != 'SCHEDULE'" class="schedule-wrapper">
            <div class="day-header-wrapper">
              <div class="day-header" *ngFor="let day of daysOfWeek" [class.red]="day == 'SUN'">
                {{day}}
              </div>
            </div>
            <table class="schedule-table" cellpadding="0">
              <tr>
                <th *ngFor="let hour of hoursOfDay">
                  <div class="hour-header">{{hour}}</div>
                </th>
              </tr>
              <tr *ngFor="let day of daysOfWeek">
                <td *ngFor="let hour of hoursOfDay">
                  <div class="hour-cell">
                    <div class="hour-content-group">
                      <div class="target"></div>
                      <div class="time"></div>
                    </div>
                  </div>
                </td>
                <tr>
            </table>
            <div class="add-schedule" (click)="openAddScheduleModal()">
              <div class="add-schedule-icon">+</div>
              {{'schedule-modal-add-button' | translate}}
            </div>
          </div>
        </div>

      </div>
      <div *ngIf="device.type == 'Alfa' && !device.simulate" class="alfa-center">
        <div class="alfa-no-settings-text">{{'device-no-alfa-settings-text' | translate}}</div>
        <div class="alfa-create-settings-button" type="button" (click)="switchToSettings()">{{'device-alfa-settings' | translate}}</div>
      </div>
      <div *ngIf="device.type != 'Alfa'" class="history-content">
        <div class="current-month-year">{{currentMonthYear}}</div>
        <div class="timeline">
          <ul class="list-inline" style="list-style: none; padding: 0">
            <li class="before-today">{{currentDateMinus3}}</li>
            <li class="before-today">{{currentDateMinus2}}</li>
            <li class="before-today">{{currentDateMinus1}}</li>
            <li class="today">{{currentDate.getDate()}}</li>
            <li class="after-today">{{currentDatePlus1}}</li>
            <li class="after-today">{{currentDatePlus2}}</li>
            <li class="after-today">{{currentDatePlus3}}</li>
          </ul>
          <img class="calendar-icon" src="../assets/images/device/calendar-icon.png" (click)="openDatepicker()">
          <input class="datepicker" style="opacity: 0" [mdDatepicker]="myDatepicker" [(ngModel)]="currentDate" (ngModelChange)="updateMonthYear()">
          <md-datepicker #myDatepicker></md-datepicker>
        </div>
        <div class="temp-chart">
          <div class="chart-loading">
            <img class="chart-loading-icon" src="../assets/images/device/loading-icon.svg">
          </div>
          <div class="chart-empty">
            <div>{{'device-no-data' | translate}}</div>
          </div>
          <div style="margin-bottom: 1em;">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-temp' | translate}}
          </div>
          <chart [options]="tempOptions" (load)="saveTempInstance($event.context)"></chart>
          <div class="current-temp">
            <img class="temp-icon" src="../assets/images/device/temp-icon.png"> {{ currentTemp | number : '2.1-1' }} °
          </div>
        </div>
        <div class="humidity-chart">
          <div class="chart-loading">
            <img class="chart-loading-icon" src="../assets/images/device/loading-icon.svg">
          </div>
          <div class="chart-empty">
            <div>{{'device-no-data' | translate}}</div>
          </div>
          <div style="margin-bottom: 1em;">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-humidity' | translate}}
          </div>
          <chart [options]="humidityOptions" (load)="saveHumidityInstance($event.context)"></chart>
          <div class="current-humidity">
            <img class="humidity-icon" src="../assets/images/device/humidity-icon.png"> {{ currentHumidity | number : '2.1-1' }} %
          </div>
        </div>
      </div>
    </div>
    <div class="settings-content">
      <div *ngIf="device.type == 'Alfa'">
        <div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-rogo-air-simulation' | translate}}
        </div>
        <div class="bullet-content">
          <div class="bullet-subtitle">{{'device-simulate-subtitle' | translate}}</div>
          <ui-switch *ngIf="device" size="small" [(ngModel)]="device.simulate" color="#448ccb" (change)="setSimulate($event)"></ui-switch>
        </div>
        <div class="simulate-settings">
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-select-hub' | translate}}
          <div class="bullet-content">
            <div class="bullet-subtitle">{{'device-select-hub-subtitle' | translate}}</div>
            <div class="alfa-select">
              <select id="alfa-select" name="hub" [(ngModel)]="device.hub" (change)="setHub()">
                <option [value]="null">{{'device-hub-none' | translate}}</option>
                <option *ngFor="let device of devices" [value]="device.id">{{device.name}}</option>
              </select>
            </div>
          </div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-select-sensor' | translate}}
          <div class="bullet-content">
            <div class="bullet-subtitle">{{'device-select-sensor-subtitle' | translate}}</div>
            <ul class="sensor-list">
              <div *ngFor="let sensor of devices">
                <div class="sensor-item" [class.active]="device.sensors.indexOf(sensor.id) >= 0" (click)="toggleSensor(sensor.id)">
                  <img class="rogo-sensor-icon" src="../assets/images/device/rogo-sensor-icon.png">
                  <div class="sensor-info">
                    <div class="sensor-name">{{sensor.name}}</div>
                    <div class="sensor-id">{{sensor.id}}</div>
                  </div>
                  <div class="sensor-tick">✓</div>
                </div>
              </div>
            </ul>
          </div>
        </div>
      </div>
      <div *ngIf="device.type != 'Alfa'">
        <div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> AIR CONDITIONER TARGET
        </div>
        <div *ngIf="device" class="air-conditioners">
          <div *ngFor="let ac of device.ac" class="ac">{{ac}}</div>
        </div>
        <div>
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> OVERRIDE LOCATION SETTINGS
          <div class="bullet-content">
            <div class="bullet-subtitle">{{'device-override-subtitle' | translate}}</div>
            <ui-switch *ngIf="device" size="small" [(ngModel)]="device.forcecontrol" color="#448ccb" (change)="setForcecontrol($event)"></ui-switch>
          </div>
        </div>
        <div class="override-settings">
          <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-settings-explain-1' | translate}}
          <ul class="bullet-text">
            <li>{{'device-settings-explain-2' | translate}}</li>
            <li>{{'device-settings-explain-3' | translate}}</li>
            <li>{{'device-settings-explain-4' | translate}}</li>
            <li>{{'device-settings-explain-5' | translate}}</li>
          </ul>
          <div class="switch-wrapper">
            <img class="switch-bg-icon" src="../assets/images/device/switch-icon.png">
            <img class="switch-icon a" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon b" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon c" src="../assets/images/device/switch-active-icon.png">
            <img class="switch-icon d" src="../assets/images/device/switch-active-icon.png">
            <span class="option-1">{{'device-no-operation' | translate}}</span>
            <span class="option-2">{{'device-set-point' | translate}}</span>
            <span class="option-3">{{'device-schedule' | translate}}</span>
            <span class="option-4">{{'device-power-off' | translate}}</span>
          </div>
          <div style="margin-top: 3em; border-top: 0.08em solid #d9dde7; padding-top: 1em">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-set-point' | translate}}
            <img *ngIf="isSetpointLoading" class="setpoint-loading-icon" src="../assets/images/device/loading-icon.svg">
          </div>
          <div class="no-select" style="margin-top: 2em;">
            <div class="minus-icon" (click)="decreaseTemp()">-</div>
            <div class="temp2">{{temp | number:'2.1-1'}}</div>
            <div class="degree">°</div>
            <div class="plus-icon" (click)="increaseTemp()">+</div>
          </div>
          <div [class.opaque]="device.mode != 'SCHEDULE'" style="margin-top: 3em; border-top: 0.08em solid #d9dde7; padding-top: 1em">
            <img class="bullet-icon" src="../assets/images/device/bullet-icon.png"> {{'device-schedule' | translate}}
          </div>
          <div [class.opaque]="device.mode != 'SCHEDULE'" class="schedule-wrapper">
            <div class="day-header-wrapper">
              <div class="day-header" *ngFor="let day of daysOfWeek" [class.red]="day == 'SUN'">
                {{day}}
              </div>
            </div>
            <table class="schedule-table" cellpadding="0">
              <tr>
                <th *ngFor="let hour of hoursOfDay">
                  <div class="hour-header">{{hour}}</div>
                </th>
              </tr>
              <tr *ngFor="let day of daysOfWeek">
                <td *ngFor="let hour of hoursOfDay">
                  <div class="hour-cell">
                    <div class="hour-content-group">
                      <div class="target"></div>
                      <div class="time"></div>
                    </div>
                  </div>
                </td>
                <tr>
            </table>
            <div class="add-schedule" (click)="openAddScheduleModal()">
              <div class="add-schedule-icon">+</div>
              {{'schedule-modal-add-button' | translate}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="add-schedule-modal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div class="add-modal-title">
          {{'schedule-modal-title' | translate}}
          <img *ngIf="isAddScheduleLoading" class="add-schedule-loading-icon" src="../assets/images/devices/loading-icon.svg">
          <div class="add-schedule-cancel" (click)="closeAddScheduleModal()">
            {{'schedule-modal-cancel' | translate}}
          </div>
        </div>
        <img class="white-bullet-icon" src="../assets/images/location-settings/white-bullet-icon.png"> {{'schedule-modal-set-time' | translate}}
        <div class="time-picker-group">
          <div class="start-time">
            <div class="time-title">{{'schedule-modal-start' | translate}}</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="plusStartHour()">
              <div class="dial-content">{{startHour | number : '2.0-0'}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="minusStartHour()">
            </div>
            <div class="dial-colon">:</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="plusStartMinute()">
              <div class="dial-content">{{startMinute | number : '2.0-0'}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="minusStartMinute()">
            </div>
            <div class="dial-colon">:</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="toggleStartPeriod()">
              <div class="dial-content">{{startPeriod}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="toggleStartPeriod()">
            </div>
          </div>
          <div class="end-time">
            <div class="time-title">{{'schedule-modal-end' | translate}}</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="plusEndHour()">
              <div class="dial-content">{{endHour | number : '2.0-0'}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="minusEndHour()">
            </div>
            <div class="dial-colon">:</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="plusEndMinute()">
              <div class="dial-content">{{endMinute | number : '2.0-0'}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="minusEndMinute()">
            </div>
            <div class="dial-colon">:</div>
            <div class="time-dial">
              <img class="dial-up" src="../assets/images/location-settings/dial-up.png" (click)="toggleEndPeriod()">
              <div class="dial-content">{{endPeriod}}</div>
              <img class="dial-down" src="../assets/images/location-settings/dial-down.png" (click)="toggleEndPeriod()">
            </div>
          </div>
        </div>
        <img class="white-bullet-icon" src="../assets/images/location-settings/white-bullet-icon.png"> {{'schedule-modal-set-day' | translate}}
        <div class="all-week-switch" style="margin-left: 0.5em">
          {{'schedule-modal-every-day' | translate}}
          <ui-switch size="small" [(ngModel)]="allWeekSwitch"></ui-switch>
        </div>
        <div class="weekday-group">
          <div class="weekday-wrapper">
            <div class="weekday" *ngFor="let day of daysOfWeek" [class.active]="day == scheduleDay" (click)="setScheduleDay(day)">{{day}}</div>
          </div>
        </div>
        <img class="white-bullet-icon" src="../assets/images/location-settings/white-bullet-icon.png"> Setpoint
        <div class="no-select setpoint-area">
          <div class="minus-icon" (click)="decreaseScheduleTemp()">-</div>
          <div class="temp2">{{scheduleTemp | number:'2.1-1'}}</div>
          <div class="degree">°</div>
          <div class="plus-icon" (click)="increaseScheduleTemp()">+</div>
        </div>
        <div class="set-schedule-button" (click)="setSchedule()">
          {{'schedule-modal-set' | translate}}
        </div>
      </div>
    </div>
  </div>
</div>